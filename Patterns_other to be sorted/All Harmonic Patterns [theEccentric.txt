All Harmonic Patterns [theEccentricTrader]

// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © theEccentricTrader
//@version=6

indicator('All Harmonic Patterns [theEccentricTrader]', overlay = true, max_lines_count = 500, max_labels_count = 500)

/////////////
// IMPORTS //
/////////////

import theEccentricTrader/PubLibSwing/3 as sw
import theEccentricTrader/PubLibPattern/4 as pa

////////////////////
// PATTERN INPUTS //
////////////////////

bear_pattern_colour = input(color.red, 'Bearish Pattern Colour', group = 'Pattern Colours')
bull_pattern_colour = input(color.green, 'Bullish Pattern Colour', group = 'Pattern Colours')
neutral_pattern_colour = input(color.blue, 'Neutral Pattern Colour', group = 'Pattern Colours')
dot_colour = input(color.blue, 'Dotted Line Colour', group = 'Pattern Colours')
label_colour = input(color.blue, 'Label Colour', group = 'Pattern Colours')

show_bear_5_0 = input(true, 'Show Bear 5-0', group = 'Patterns')
show_bull_5_0 = input(true, 'Show Bull 5-0', group = 'Patterns')
show_bear_abcd = input(true, 'Show Bear ABCD', group = 'Patterns')
show_bull_abcd = input(true, 'Show Bull ABCD', group = 'Patterns')
show_bear_alt_bat = input(true, 'Show Bear Alt. Bat', group = 'Patterns')
show_bull_alt_bat = input(true, 'Show Bull Alt. Bat', group = 'Patterns')
show_bear_bat = input(true, 'Show Bear Bat', group = 'Patterns')
show_bull_bat = input(true, 'Show Bull Bat', group = 'Patterns')
show_bear_butterfly = input(true, 'Show Bear Butterfly', group = 'Patterns')
show_bull_butterfly = input(true, 'Show Bull Butterfly', group = 'Patterns')
show_bear_cassiopeia_a = input(true, 'Show Bear Cassiopeia A', group = 'Patterns')
show_bull_cassiopeia_a = input(true, 'Show Bull Cassiopeia A', group = 'Patterns')
show_bear_cassiopeia_b = input(true, 'Show Bear Cassiopeia B', group = 'Patterns')
show_bull_cassiopeia_b = input(true, 'Show Bull Cassiopeia B', group = 'Patterns')
show_bear_cassiopeia_c = input(true, 'Show Bear Cassiopeia C', group = 'Patterns')
show_bull_cassiopeia_c = input(true, 'Show Bull Cassiopeia C', group = 'Patterns')
show_bear_crab = input(true, 'Show Bear Crab', group = 'Patterns')
show_bull_crab = input(true, 'Show Bull Crab', group = 'Patterns')
show_bear_deep_crab = input(true, 'Show Bear Deep Crab', group = 'Patterns')
show_bull_deep_crab = input(true, 'Show Bull Deep Crab', group = 'Patterns')
show_bear_cypher = input(true, 'Show Bear Cypher', group = 'Patterns')
show_bull_cypher = input(true, 'Show Bull Cypher', group = 'Patterns')
show_bear_gartley = input(true, 'Show Bear Gartley', group = 'Patterns')
show_bull_gartley = input(true, 'Show Bull Gartley', group = 'Patterns')
show_bear_shark = input(true, 'Show Bear Shark', group = 'Patterns')
show_bull_shark = input(true, 'Show Bull Shark', group = 'Patterns')
show_bear_three_drive = input(true, 'Show Bear Three-Drive', group = 'Patterns')
show_bull_three_drive = input(true, 'Show Bull Three-Drive', group = 'Patterns')

ab_low_tol = input(defval = 10, title = 'AB Lower Tolerance (%)', group = 'Pattern Tolerances')
ab_up_tol = input(defval = 10, title = 'AB Upper Tolerance (%)', group = 'Pattern Tolerances')
bc_low_tol = input(defval = 10, title = 'BC Lower Tolerance (%)', group = 'Pattern Tolerances')
bc_up_tol = input(defval = 10, title = 'BC Upper Tolerance (%)', group = 'Pattern Tolerances')
cd_low_tol = input(defval = 10, title = 'CD Lower Tolerance (%)', group = 'Pattern Tolerances')
cd_up_tol = input(defval = 10, title = 'CD Upper Tolerance (%)', group = 'Pattern Tolerances')
ad_low_tol = input(defval = 10, title = 'AD Lower Tolerance (%)', group = 'Pattern Tolerances')
ad_up_tol = input(defval = 10, title = 'AD Upper Tolerance (%)', group = 'Pattern Tolerances')
xc_low_tol = input(defval = 10, title = 'XC Lower Tolerance (%)', group = 'Pattern Tolerances')
xc_up_tol = input(defval = 10, title = 'XC Upper Tolerance (%)', group = 'Pattern Tolerances')
x1_low_tol = input(defval = 20, title = 'X1 Lower Tolerance (%)', group = 'Pattern Tolerances')
a1_low_tol = input(defval = 20, title = 'A1 Lower Tolerance (%)', group = 'Pattern Tolerances')
a1_up_tol = input(defval = 20, title = 'A1 Upper Tolerance (%)', group = 'Pattern Tolerances')
a2_low_tol = input(defval = 20, title = 'A2 Lower Tolerance (%)', group = 'Pattern Tolerances')
a2_up_tol = input(defval = 20, title = 'A2 Upper Tolerance (%)', group = 'Pattern Tolerances')
b2_low_tol = input(defval = 20, title = 'B2 Lower Tolerance (%)', group = 'Pattern Tolerances')
b2_up_tol = input(defval = 20, title = 'B2 Upper Tolerance (%)', group = 'Pattern Tolerances')
b3_low_tol = input(defval = 20, title = 'B3 Lower Tolerance (%)', group = 'Pattern Tolerances')
b3_up_tol = input(defval = 20, title = 'B3 Upper Tolerance (%)', group = 'Pattern Tolerances')

bear_5_0_alert = input(true, 'Bear 5-0 Alert', group = 'Alerts')
bull_5_0_alert = input(true, 'Bull 5-0 Alert', group = 'Alerts')
bear_abcd_alert = input(true, 'Bear ABCD Alert', group = 'Alerts')
bull_abcd_alert = input(true, 'Bull ABCD Alert', group = 'Alerts')
bear_alt_bat_alert = input(true, 'Bear Alt. Bat Alert', group = 'Alerts')
bull_alt_bat_alert = input(true, 'Bull Alt. Bat Alert', group = 'Alerts')
bear_bat_alert = input(true, 'Bear Bat Alert', group = 'Alerts')
bull_bat_alert = input(true, 'Bull Bat Alert', group = 'Alerts')
bear_butterfly_alert = input(true, 'Bear Butterfly Alert', group = 'Alerts')
bull_butterfly_alert = input(true, 'Bull Butterfly Alert', group = 'Alerts')
bear_cassiopeia_a_alert = input(true, 'Bear Cassiopeia A Alert', group = 'Alerts')
bull_cassiopeia_a_alert = input(true, 'Bull Cassiopeia A Alert', group = 'Alerts')
bear_cassiopeia_b_alert = input(true, 'Bear Cassiopeia B Alert', group = 'Alerts')
bull_cassiopeia_b_alert = input(true, 'Bull Cassiopeia B Alert', group = 'Alerts')
bear_cassiopeia_c_alert = input(true, 'Bear Cassiopeia C Alert', group = 'Alerts')
bull_cassiopeia_c_alert = input(true, 'Bull Cassiopeia C Alert', group = 'Alerts')
bear_crab_alert = input(true, 'Bear Crab Alert', group = 'Alerts')
bull_crab_alert = input(true, 'Bull Crab Alert', group = 'Alerts')
bear_deep_crab_alert = input(true, 'Bear Deep Crab Alert', group = 'Alerts')
bull_deep_crab_alert = input(true, 'Bull Deep Crab Alert', group = 'Alerts')
bear_cypher_alert = input(true, 'Bear Cypher Alert', group = 'Alerts')
bull_cypher_alert = input(true, 'Bull Cypher Alert', group = 'Alerts')
bear_gartley_alert = input(true, 'Bear Gartley Alert', group = 'Alerts')
bull_gartley_alert = input(true, 'Bull Gartley Alert', group = 'Alerts')
bear_shark_alert = input(true, 'Bear Shark Alert', group = 'Alerts')
bull_shark_alert = input(true, 'Bull Shark Alert', group = 'Alerts')
bear_three_drive_alert = input(true, 'Bear Three-Drive Alert', group = 'Alerts')
bull_three_drive_alert = input(true, 'Bull Three-Drive Alert', group = 'Alerts')

///////////////////////////
// CONDITIONAL VARIABLES //
///////////////////////////

sh = sw.sh()
sl = sw.sl()

shp_0 = sw.shp(0)
shpbi_0 = sw.shpbi(0)
shrr_0 = sw.shrr(0)

slp_0 = sw.slp(0)
slpbi_0 = sw.slpbi(0)
slrr_0 = sw.slrr(0)

shp_1 = sw.shp(1)
shpbi_1 = sw.shpbi(1)
shrr_1 = sw.shrr(1)

slp_1 = sw.slp(1)
slpbi_1 = sw.slpbi(1)
slrr_1 = sw.slrr(1)

shp_2 = sw.shp(2)
shpbi_2 = sw.shpbi(2)
shrr_2 = sw.shrr(2)

slp_2 = sw.slp(2)
slpbi_2 = sw.slpbi(2)
slrr_2 = sw.slrr(2)

bear_5_0 = pa.bear_5_0(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)
bull_5_0 = pa.bull_5_0(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)

bear_abcd = pa.bear_abcd(bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)
bull_abcd = pa.bull_abcd(bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)

bear_alt_bat = pa.bear_alt_bat(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_alt_bat = pa.bull_alt_bat(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_bat = pa.bear_bat(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_bat = pa.bull_bat(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_butterfly = pa.bear_butterfly(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_butterfly = pa.bull_butterfly(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_cassiopeia_a = pa.bear_cassiopeia_a(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)
bull_cassiopeia_a = pa.bull_cassiopeia_a(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)

bear_cassiopeia_b = pa.bear_cassiopeia_b(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)
bull_cassiopeia_b = pa.bull_cassiopeia_b(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)

bear_cassiopeia_c = pa.bear_cassiopeia_c(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)
bull_cassiopeia_c = pa.bull_cassiopeia_c(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol)

bear_crab = pa.bear_crab(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_crab = pa.bull_crab(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_deep_crab = pa.bear_deep_crab(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_deep_crab = pa.bull_deep_crab(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_cypher = pa.bear_cypher(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, xc_low_tol, xc_up_tol)
bull_cypher = pa.bull_cypher(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, xc_low_tol, xc_up_tol)

bear_gartley = pa.bear_gartley(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)
bull_gartley = pa.bull_gartley(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, cd_low_tol, cd_up_tol, ad_low_tol, ad_up_tol)

bear_shark = pa.bear_shark(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, xc_low_tol, xc_up_tol)
bull_shark = pa.bull_shark(ab_low_tol, ab_up_tol, bc_low_tol, bc_up_tol, xc_low_tol, xc_up_tol)

bear_three_drive = pa.bear_three_drive(x1_low_tol, a1_low_tol, a1_up_tol, a2_low_tol, a2_up_tol, b2_low_tol, b2_up_tol, b3_low_tol, b3_up_tol)
bull_three_drive = pa.bull_three_drive(x1_low_tol, a1_low_tol, a1_up_tol, a2_low_tol, a2_up_tol, b2_low_tol, b2_up_tol, b3_low_tol, b3_up_tol)

/////////
// 5-0 //
/////////

var bear_5_0_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_5_0_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_5_0_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_5_0_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_5_0_line_5 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_5_0_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_5_0_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_5_0_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_5_0_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'O', textcolor = label_colour)
var bear_5_0_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_5_0_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bear_5_0_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_5_0_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_5_0_label_6 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_5_0 and barstate.isconfirmed
    if show_bear_5_0
        line.set_xy1(bear_5_0_line_1, slpbi_2, slp_2)
        line.set_xy2(bear_5_0_line_1, shpbi_2, shp_2)
        line.set_xy1(bear_5_0_line_2, shpbi_2, shp_2)
        line.set_xy2(bear_5_0_line_2, slpbi_1, slp_1)
        line.set_xy1(bear_5_0_line_3, slpbi_1, slp_1)
        line.set_xy2(bear_5_0_line_3, shpbi_1, shp_1)
        line.set_xy1(bear_5_0_line_4, shpbi_1, shp_1)
        line.set_xy2(bear_5_0_line_4, slpbi_0, slp_0)
        line.set_xy1(bear_5_0_line_5, slpbi_0, slp_0)
        line.set_xy2(bear_5_0_line_5, shpbi_0, shp_0)
        line.set_xy1(bear_5_0_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_5_0_line_6, shpbi_1, shp_1)
        line.set_xy1(bear_5_0_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_5_0_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_5_0_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_5_0_line_8, slpbi_0, slp_0)
        label.set_xy(bear_5_0_label_1, slpbi_2, slp_2)
        label.set_xy(bear_5_0_label_2, shpbi_2, shp_2)
        label.set_xy(bear_5_0_label_3, slpbi_1, slp_1)
        label.set_xy(bear_5_0_label_4, shpbi_1, shp_1)
        label.set_xy(bear_5_0_label_5, slpbi_0, slp_0)
        label.set_xy(bear_5_0_label_6, shpbi_0, shp_0)
        label.set_text(bear_5_0_label_4, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_5_0_label_5, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_5_0_label_6, 'BEAR 5-0\nD (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_5_0_alert
        alert('Bearish 5-0')

var bull_5_0_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_5_0_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_5_0_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_5_0_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_5_0_line_5 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_5_0_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_5_0_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_5_0_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_5_0_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'O', textcolor = label_colour)
var bull_5_0_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_5_0_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_5_0_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_5_0_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_5_0_label_6 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_5_0 and barstate.isconfirmed
    if show_bull_5_0
        line.set_xy1(bull_5_0_line_1, shpbi_2, shp_2)
        line.set_xy2(bull_5_0_line_1, slpbi_2, slp_2)
        line.set_xy1(bull_5_0_line_2, slpbi_2, slp_2)
        line.set_xy2(bull_5_0_line_2, shpbi_1, shp_1)
        line.set_xy1(bull_5_0_line_3, shpbi_1, shp_1)
        line.set_xy2(bull_5_0_line_3, slpbi_1, slp_1)
        line.set_xy1(bull_5_0_line_4, slpbi_1, slp_1)
        line.set_xy2(bull_5_0_line_4, shpbi_0, shp_0)
        line.set_xy1(bull_5_0_line_5, shpbi_0, shp_0)
        line.set_xy2(bull_5_0_line_5, slpbi_0, slp_0)
        line.set_xy1(bull_5_0_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_5_0_line_6, slpbi_1, slp_1)
        line.set_xy1(bull_5_0_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_5_0_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_5_0_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_5_0_line_8, shpbi_0, shp_0)
        label.set_xy(bull_5_0_label_1, shpbi_2, shp_2)
        label.set_xy(bull_5_0_label_2, slpbi_2, slp_2)
        label.set_xy(bull_5_0_label_3, shpbi_1, shp_1)
        label.set_xy(bull_5_0_label_4, slpbi_1, slp_1)
        label.set_xy(bull_5_0_label_5, shpbi_0, shp_0)
        label.set_xy(bull_5_0_label_6, slpbi_0, slp_0)
        label.set_text(bull_5_0_label_4, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_5_0_label_5, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_5_0_label_6, 'Bull 5-0\nD (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_5_0_alert
        alert('Bullish 5-0')

//////////
// ABCD //
//////////

var bear_abcd_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_abcd_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_abcd_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_abcd_line_4 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_abcd_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_abcd_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_abcd_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'B', textcolor = label_colour)
var bear_abcd_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_abcd_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_abcd and barstate.isconfirmed
    if show_bear_abcd
        line.set_xy1(bear_abcd_line_1, slpbi_1, slp_1)
        line.set_xy2(bear_abcd_line_1, shpbi_1, shp_1)
        line.set_xy1(bear_abcd_line_2, shpbi_1, shp_1)
        line.set_xy2(bear_abcd_line_2, slpbi_0, slp_0)
        line.set_xy1(bear_abcd_line_3, slpbi_0, slp_0)
        line.set_xy2(bear_abcd_line_3, shpbi_0, shp_0)
        line.set_xy1(bear_abcd_line_4, shpbi_1, shp_1)
        line.set_xy2(bear_abcd_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_abcd_line_5, slpbi_1, slp_1)
        line.set_xy2(bear_abcd_line_5, slpbi_0, slp_0)
        label.set_xy(bear_abcd_label_1, slpbi_1, slp_1)
        label.set_xy(bear_abcd_label_2, shpbi_1, shp_1)
        label.set_xy(bear_abcd_label_3, slpbi_0, slp_0)
        label.set_xy(bear_abcd_label_4, shpbi_0, shp_0)
        label.set_text(bear_abcd_label_3, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_abcd_label_4, 'BEAR ABCD\nD (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_abcd_alert
        alert('Bearish ABCD')

var bull_abcd_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_abcd_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_abcd_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_abcd_line_4 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_abcd_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_abcd_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_abcd_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'B', textcolor = label_colour)
var bull_abcd_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_abcd_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_abcd and barstate.isconfirmed
    if show_bull_abcd
        line.set_xy1(bull_abcd_line_1, shpbi_1, shp_1)
        line.set_xy2(bull_abcd_line_1, slpbi_1, slp_1)
        line.set_xy1(bull_abcd_line_2, slpbi_1, slp_1)
        line.set_xy2(bull_abcd_line_2, shpbi_0, shp_0)
        line.set_xy1(bull_abcd_line_3, shpbi_0, shp_0)
        line.set_xy2(bull_abcd_line_3, slpbi_0, slp_0)
        line.set_xy1(bull_abcd_line_4, slpbi_1, slp_1)
        line.set_xy2(bull_abcd_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_abcd_line_5, shpbi_1, shp_1)
        line.set_xy2(bull_abcd_line_5, shpbi_0, shp_0)
        label.set_xy(bull_abcd_label_1, shpbi_1, shp_1)
        label.set_xy(bull_abcd_label_2, slpbi_1, slp_1)
        label.set_xy(bull_abcd_label_3, shpbi_0, shp_0)
        label.set_xy(bull_abcd_label_4, slpbi_0, slp_0)
        label.set_text(bull_abcd_label_3, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_abcd_label_4, 'Bull ABCD\nD (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_abcd_alert
        alert('Bullish ABCD')

///////////////////
// ALTERNATE BAT //
///////////////////

var bear_alt_bat_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_alt_bat_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_alt_bat_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_alt_bat_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_alt_bat_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_alt_bat_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_alt_bat_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_alt_bat_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_alt_bat_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_alt_bat_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_alt_bat_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_alt_bat_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_alt_bat_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_alt_bat and barstate.isconfirmed
    if show_bear_alt_bat
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_alt_bat_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_alt_bat_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_alt_bat_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_alt_bat_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_alt_bat_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_alt_bat_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_alt_bat_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_alt_bat_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_alt_bat_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_alt_bat_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_alt_bat_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_alt_bat_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_alt_bat_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_alt_bat_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_alt_bat_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_alt_bat_line_8, slpbi_0, slp_0)
        label.set_xy(bear_alt_bat_label_1, shpbi_2, shp_2)
        label.set_xy(bear_alt_bat_label_2, slpbi_1, slp_1)
        label.set_xy(bear_alt_bat_label_3, shpbi_1, shp_1)
        label.set_xy(bear_alt_bat_label_4, slpbi_0, slp_0)
        label.set_xy(bear_alt_bat_label_5, shpbi_0, shp_0)
        label.set_text(bear_alt_bat_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_alt_bat_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_alt_bat_label_5, 'BEAR ALT. BAT\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_alt_bat_alert
        alert('Bearish Alt. Bat')

var bull_alt_bat_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_alt_bat_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_alt_bat_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_alt_bat_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_alt_bat_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_alt_bat_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_alt_bat_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_alt_bat_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_alt_bat_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_alt_bat_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_alt_bat_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_alt_bat_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_alt_bat_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_alt_bat and barstate.isconfirmed
    if show_bull_alt_bat
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_alt_bat_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_alt_bat_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_alt_bat_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_alt_bat_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_alt_bat_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_alt_bat_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_alt_bat_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_alt_bat_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_alt_bat_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_alt_bat_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_alt_bat_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_alt_bat_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_alt_bat_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_alt_bat_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_alt_bat_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_alt_bat_line_8, shpbi_0, shp_0)
        label.set_xy(bull_alt_bat_label_1, slpbi_2, slp_2)
        label.set_xy(bull_alt_bat_label_2, shpbi_1, shp_1)
        label.set_xy(bull_alt_bat_label_3, slpbi_1, slp_1)
        label.set_xy(bull_alt_bat_label_4, shpbi_0, shp_0)
        label.set_xy(bull_alt_bat_label_5, slpbi_0, slp_0)
        label.set_text(bull_alt_bat_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_alt_bat_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_alt_bat_label_5, 'BULL ALT. BAT\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_alt_bat_alert
        alert('Bullish Alt. Bat')

/////////
// BAT //
/////////

var bear_bat_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_bat_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_bat_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_bat_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_bat_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_bat_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_bat_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_bat_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_bat_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_bat_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_bat_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_bat_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_bat_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_bat and barstate.isconfirmed
    if show_bear_bat
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_bat_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_bat_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_bat_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_bat_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_bat_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_bat_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_bat_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_bat_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_bat_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_bat_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_bat_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_bat_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_bat_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_bat_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_bat_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_bat_line_8, slpbi_0, slp_0)
        label.set_xy(bear_bat_label_1, shpbi_2, shp_2)
        label.set_xy(bear_bat_label_2, slpbi_1, slp_1)
        label.set_xy(bear_bat_label_3, shpbi_1, shp_1)
        label.set_xy(bear_bat_label_4, slpbi_0, slp_0)
        label.set_xy(bear_bat_label_5, shpbi_0, shp_0)
        label.set_text(bear_bat_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_bat_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_bat_label_5, 'BEAR BAT\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_bat_alert
        alert('Bearish Bat')

var bull_bat_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_bat_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_bat_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_bat_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_bat_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_bat_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_bat_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_bat_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_bat_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_bat_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_bat_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_bat_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_bat_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_bat and barstate.isconfirmed
    if show_bull_bat
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_bat_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_bat_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_bat_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_bat_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_bat_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_bat_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_bat_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_bat_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_bat_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_bat_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_bat_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_bat_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_bat_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_bat_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_bat_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_bat_line_8, shpbi_0, shp_0)
        label.set_xy(bull_bat_label_1, slpbi_2, slp_2)
        label.set_xy(bull_bat_label_2, shpbi_1, shp_1)
        label.set_xy(bull_bat_label_3, slpbi_1, slp_1)
        label.set_xy(bull_bat_label_4, shpbi_0, shp_0)
        label.set_xy(bull_bat_label_5, slpbi_0, slp_0)
        label.set_text(bull_bat_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_bat_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_bat_label_5, 'BULL BAT\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_bat_alert
        alert('Bullish Bat')

///////////////
// BUTTERFLY //
///////////////

var bear_butterfly_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_butterfly_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_butterfly_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_butterfly_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_butterfly_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_butterfly_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_butterfly_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_butterfly_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_butterfly_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_butterfly_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_butterfly_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_butterfly_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_butterfly_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_butterfly and barstate.isconfirmed
    if show_bear_butterfly
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_butterfly_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_butterfly_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_butterfly_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_butterfly_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_butterfly_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_butterfly_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_butterfly_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_butterfly_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_butterfly_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_butterfly_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_butterfly_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_butterfly_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_butterfly_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_butterfly_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_butterfly_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_butterfly_line_8, slpbi_0, slp_0)
        label.set_xy(bear_butterfly_label_1, shpbi_2, shp_2)
        label.set_xy(bear_butterfly_label_2, slpbi_1, slp_1)
        label.set_xy(bear_butterfly_label_3, shpbi_1, shp_1)
        label.set_xy(bear_butterfly_label_4, slpbi_0, slp_0)
        label.set_xy(bear_butterfly_label_5, shpbi_0, shp_0)
        label.set_text(bear_butterfly_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_butterfly_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_butterfly_label_5, 'BEAR BUTTERFLY\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_butterfly_alert
        alert('Bearish Butterfly')

var bull_butterfly_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_butterfly_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_butterfly_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_butterfly_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_butterfly_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_butterfly_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_butterfly_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_butterfly_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_butterfly_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_butterfly_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_butterfly_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_butterfly_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_butterfly_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_butterfly and barstate.isconfirmed
    if show_bull_butterfly
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_butterfly_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_butterfly_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_butterfly_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_butterfly_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_butterfly_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_butterfly_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_butterfly_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_butterfly_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_butterfly_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_butterfly_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_butterfly_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_butterfly_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_butterfly_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_butterfly_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_butterfly_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_butterfly_line_8, shpbi_0, shp_0)
        label.set_xy(bull_butterfly_label_1, slpbi_2, slp_2)
        label.set_xy(bull_butterfly_label_2, shpbi_1, shp_1)
        label.set_xy(bull_butterfly_label_3, slpbi_1, slp_1)
        label.set_xy(bull_butterfly_label_4, shpbi_0, shp_0)
        label.set_xy(bull_butterfly_label_5, slpbi_0, slp_0)
        label.set_text(bull_butterfly_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_butterfly_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_butterfly_label_5, 'BULL BUTTERFLY\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_butterfly_alert
        alert('Bullish Butterfly')

//////////////////
// CASSIOPEIA A //
//////////////////

var bear_cassiopeia_a_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_a_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_a_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_a_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_a_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_a_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_a_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_a_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_a_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_cassiopeia_a_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_cassiopeia_a_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_cassiopeia_a_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_cassiopeia_a_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_cassiopeia_a and barstate.isconfirmed
    if show_bear_cassiopeia_a
        line.set_xy1(bear_cassiopeia_a_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_a_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_cassiopeia_a_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_a_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_a_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_a_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_cassiopeia_a_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_cassiopeia_a_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_a_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_a_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_a_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_a_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_a_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_a_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_a_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_a_line_8, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_a_label_1, shpbi_2, shp_2)
        label.set_xy(bear_cassiopeia_a_label_2, slpbi_1, slp_1)
        label.set_xy(bear_cassiopeia_a_label_3, shpbi_1, shp_1)
        label.set_xy(bear_cassiopeia_a_label_4, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_a_label_5, shpbi_0, shp_0)
        label.set_text(bear_cassiopeia_a_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_cassiopeia_a_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_cassiopeia_a_label_5, 'BEAR CASSIOPEIA A\nD (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_cassiopeia_a_alert
        alert('Bearish Cassiopeia A')

var bull_cassiopeia_a_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_a_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_a_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_a_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_a_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_a_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_a_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_a_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_a_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_cassiopeia_a_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_cassiopeia_a_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_cassiopeia_a_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_cassiopeia_a_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_cassiopeia_a and barstate.isconfirmed
    if show_bull_cassiopeia_a
        line.set_xy1(bull_cassiopeia_a_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_a_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_cassiopeia_a_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_a_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_a_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_a_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_cassiopeia_a_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_cassiopeia_a_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_a_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_a_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_a_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_a_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_a_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_a_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_a_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_a_line_8, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_a_label_1, slpbi_2, slp_2)
        label.set_xy(bull_cassiopeia_a_label_2, shpbi_1, shp_1)
        label.set_xy(bull_cassiopeia_a_label_3, slpbi_1, slp_1)
        label.set_xy(bull_cassiopeia_a_label_4, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_a_label_5, slpbi_0, slp_0)
        label.set_text(bull_cassiopeia_a_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_cassiopeia_a_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_cassiopeia_a_label_5, 'BULL CASSIOPEIA A\nD (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_cassiopeia_a_alert
        alert('Bullish Cassiopeia A')

//////////////////
// CASSIOPEIA B //
//////////////////

var bear_cassiopeia_b_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_b_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_b_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_b_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_b_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_b_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_b_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_b_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_b_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_cassiopeia_b_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_cassiopeia_b_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_cassiopeia_b_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_cassiopeia_b_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_cassiopeia_b and barstate.isconfirmed
    if show_bear_cassiopeia_b
        line.set_xy1(bear_cassiopeia_b_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_b_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_cassiopeia_b_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_b_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_b_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_b_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_cassiopeia_b_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_cassiopeia_b_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_b_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_b_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_b_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_b_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_b_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_b_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_b_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_b_line_8, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_b_label_1, shpbi_2, shp_2)
        label.set_xy(bear_cassiopeia_b_label_2, slpbi_1, slp_1)
        label.set_xy(bear_cassiopeia_b_label_3, shpbi_1, shp_1)
        label.set_xy(bear_cassiopeia_b_label_4, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_b_label_5, shpbi_0, shp_0)
        label.set_text(bear_cassiopeia_b_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_cassiopeia_b_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_cassiopeia_b_label_5, 'BEAR CASSIOPEIA B\nD (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_cassiopeia_b_alert
        alert('Bearish Cassiopeia B')

var bull_cassiopeia_b_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_b_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_b_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_b_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_b_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_b_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_b_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_b_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_b_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_cassiopeia_b_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_cassiopeia_b_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_cassiopeia_b_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_cassiopeia_b_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_cassiopeia_b and barstate.isconfirmed
    if show_bull_cassiopeia_b
        line.set_xy1(bull_cassiopeia_b_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_b_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_cassiopeia_b_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_b_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_b_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_b_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_cassiopeia_b_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_cassiopeia_b_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_b_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_b_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_b_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_b_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_b_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_b_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_b_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_b_line_8, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_b_label_1, slpbi_2, slp_2)
        label.set_xy(bull_cassiopeia_b_label_2, shpbi_1, shp_1)
        label.set_xy(bull_cassiopeia_b_label_3, slpbi_1, slp_1)
        label.set_xy(bull_cassiopeia_b_label_4, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_b_label_5, slpbi_0, slp_0)
        label.set_text(bull_cassiopeia_b_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_cassiopeia_b_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_cassiopeia_b_label_5, 'BULL CASSIOPEIA B\nD (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_cassiopeia_b_alert
        alert('Bullish Cassiopeia B')

//////////////////
// CASSIOPEIA C //
//////////////////

var bear_cassiopeia_c_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_c_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_c_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_c_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cassiopeia_c_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_c_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_c_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_c_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cassiopeia_c_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_cassiopeia_c_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_cassiopeia_c_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_cassiopeia_c_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_cassiopeia_c_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_cassiopeia_c and barstate.isconfirmed
    if show_bear_cassiopeia_c
        line.set_xy1(bear_cassiopeia_c_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_c_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_cassiopeia_c_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_c_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_c_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_c_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_cassiopeia_c_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_cassiopeia_c_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_c_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_c_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_cassiopeia_c_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_cassiopeia_c_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_c_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_cassiopeia_c_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_cassiopeia_c_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_cassiopeia_c_line_8, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_c_label_1, shpbi_2, shp_2)
        label.set_xy(bear_cassiopeia_c_label_2, slpbi_1, slp_1)
        label.set_xy(bear_cassiopeia_c_label_3, shpbi_1, shp_1)
        label.set_xy(bear_cassiopeia_c_label_4, slpbi_0, slp_0)
        label.set_xy(bear_cassiopeia_c_label_5, shpbi_0, shp_0)
        label.set_text(bear_cassiopeia_c_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_cassiopeia_c_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_cassiopeia_c_label_5, 'BEAR CASSIOPEIA C\nD (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_cassiopeia_c_alert
        alert('Bearish Cassiopeia C')

var bull_cassiopeia_c_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_c_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_c_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_c_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cassiopeia_c_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_c_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_c_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_c_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cassiopeia_c_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_cassiopeia_c_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_cassiopeia_c_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_cassiopeia_c_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_cassiopeia_c_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_cassiopeia_c and barstate.isconfirmed
    if show_bull_cassiopeia_c
        line.set_xy1(bull_cassiopeia_c_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_c_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_cassiopeia_c_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_c_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_c_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_c_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_cassiopeia_c_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_cassiopeia_c_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_c_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_c_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_cassiopeia_c_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_cassiopeia_c_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_c_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_cassiopeia_c_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_cassiopeia_c_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_cassiopeia_c_line_8, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_c_label_1, slpbi_2, slp_2)
        label.set_xy(bull_cassiopeia_c_label_2, shpbi_1, shp_1)
        label.set_xy(bull_cassiopeia_c_label_3, slpbi_1, slp_1)
        label.set_xy(bull_cassiopeia_c_label_4, shpbi_0, shp_0)
        label.set_xy(bull_cassiopeia_c_label_5, slpbi_0, slp_0)
        label.set_text(bull_cassiopeia_c_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_cassiopeia_c_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_cassiopeia_c_label_5, 'BULL CASSIOPEIA C\nD (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_cassiopeia_c_alert
        alert('Bullish Cassiopeia C')

//////////
// CRAB //
//////////

var bear_crab_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_crab_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_crab_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_crab_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_crab_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_crab_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_crab_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_crab_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_crab_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_crab_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_crab_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_crab_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_crab_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_crab and barstate.isconfirmed
    if show_bear_crab
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_crab_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_crab_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_crab_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_crab_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_crab_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_crab_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_crab_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_crab_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_crab_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_crab_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_crab_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_crab_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_crab_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_crab_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_crab_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_crab_line_8, slpbi_0, slp_0)
        label.set_xy(bear_crab_label_1, shpbi_2, shp_2)
        label.set_xy(bear_crab_label_2, slpbi_1, slp_1)
        label.set_xy(bear_crab_label_3, shpbi_1, shp_1)
        label.set_xy(bear_crab_label_4, slpbi_0, slp_0)
        label.set_xy(bear_crab_label_5, shpbi_0, shp_0)
        label.set_text(bear_crab_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_crab_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_crab_label_5, 'BEAR CRAB\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_crab_alert
        alert('Bearish Crab')

var bull_crab_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_crab_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_crab_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_crab_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_crab_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_crab_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_crab_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_crab_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_crab_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_crab_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_crab_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_crab_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_crab_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_crab and barstate.isconfirmed
    if show_bull_crab
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_crab_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_crab_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_crab_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_crab_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_crab_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_crab_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_crab_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_crab_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_crab_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_crab_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_crab_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_crab_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_crab_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_crab_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_crab_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_crab_line_8, shpbi_0, shp_0)
        label.set_xy(bull_crab_label_1, slpbi_2, slp_2)
        label.set_xy(bull_crab_label_2, shpbi_1, shp_1)
        label.set_xy(bull_crab_label_3, slpbi_1, slp_1)
        label.set_xy(bull_crab_label_4, shpbi_0, shp_0)
        label.set_xy(bull_crab_label_5, slpbi_0, slp_0)
        label.set_text(bull_crab_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_crab_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_crab_label_5, 'BULL CRAB\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_crab_alert
        alert('Bullish Crab')

///////////////
// DEEP CRAB //
///////////////

var bear_deep_crab_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_deep_crab_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_deep_crab_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_deep_crab_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_deep_crab_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_deep_crab_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_deep_crab_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_deep_crab_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_deep_crab_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_deep_crab_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_deep_crab_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_deep_crab_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_deep_crab_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_deep_crab and barstate.isconfirmed
    if show_bear_deep_crab
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_deep_crab_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_deep_crab_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_deep_crab_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_deep_crab_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_deep_crab_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_deep_crab_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_deep_crab_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_deep_crab_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_deep_crab_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_deep_crab_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_deep_crab_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_deep_crab_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_deep_crab_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_deep_crab_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_deep_crab_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_deep_crab_line_8, slpbi_0, slp_0)
        label.set_xy(bear_deep_crab_label_1, shpbi_2, shp_2)
        label.set_xy(bear_deep_crab_label_2, slpbi_1, slp_1)
        label.set_xy(bear_deep_crab_label_3, shpbi_1, shp_1)
        label.set_xy(bear_deep_crab_label_4, slpbi_0, slp_0)
        label.set_xy(bear_deep_crab_label_5, shpbi_0, shp_0)
        label.set_text(bear_deep_crab_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_deep_crab_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_deep_crab_label_5, 'BEAR DEEP CRAB\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_deep_crab_alert
        alert('Bearish Deep Crab')

var bull_deep_crab_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_deep_crab_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_deep_crab_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_deep_crab_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_deep_crab_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_deep_crab_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_deep_crab_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_deep_crab_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_deep_crab_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_deep_crab_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_deep_crab_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_deep_crab_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_deep_crab_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_deep_crab and barstate.isconfirmed
    if show_bull_deep_crab
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_deep_crab_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_deep_crab_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_deep_crab_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_deep_crab_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_deep_crab_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_deep_crab_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_deep_crab_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_deep_crab_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_deep_crab_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_deep_crab_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_deep_crab_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_deep_crab_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_deep_crab_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_deep_crab_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_deep_crab_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_deep_crab_line_8, shpbi_0, shp_0)
        label.set_xy(bull_deep_crab_label_1, slpbi_2, slp_2)
        label.set_xy(bull_deep_crab_label_2, shpbi_1, shp_1)
        label.set_xy(bull_deep_crab_label_3, slpbi_1, slp_1)
        label.set_xy(bull_deep_crab_label_4, shpbi_0, shp_0)
        label.set_xy(bull_deep_crab_label_5, slpbi_0, slp_0)
        label.set_text(bull_deep_crab_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_deep_crab_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_deep_crab_label_5, 'BULL DEEP CRAB\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_deep_crab_alert
        alert('Bullish Deep Crab')

////////////
// CYPHER //
////////////

var bear_cypher_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cypher_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cypher_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cypher_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_cypher_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cypher_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cypher_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cypher_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_cypher_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_cypher_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_cypher_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_cypher_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_cypher_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_cypher and barstate.isconfirmed
    if show_bear_cypher
        xcrr = (shp_0 - slp_0) / (shp_2 - slp_0) * 100
        line.set_xy1(bear_cypher_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_cypher_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_cypher_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_cypher_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_cypher_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_cypher_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_cypher_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_cypher_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_cypher_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_cypher_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_cypher_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_cypher_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_cypher_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_cypher_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_cypher_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_cypher_line_8, slpbi_0, slp_0)
        label.set_xy(bear_cypher_label_1, shpbi_2, shp_2)
        label.set_xy(bear_cypher_label_2, slpbi_1, slp_1)
        label.set_xy(bear_cypher_label_3, shpbi_1, shp_1)
        label.set_xy(bear_cypher_label_4, slpbi_0, slp_0)
        label.set_xy(bear_cypher_label_5, shpbi_0, shp_0)
        label.set_text(bear_cypher_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_cypher_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_cypher_label_5, 'BEAR CYPHER\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(XC: ' + str.tostring(math.round(xcrr, 2)) + ')')
    if bear_cypher_alert
        alert('Bearish Cypher')

var bull_cypher_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cypher_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cypher_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cypher_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_cypher_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cypher_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cypher_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cypher_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_cypher_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_cypher_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_cypher_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_cypher_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_cypher_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_cypher and barstate.isconfirmed
    if show_bull_cypher
        xcrr = (shp_0 - slp_0) / (shp_0 - slp_2) * 100
        line.set_xy1(bull_cypher_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_cypher_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_cypher_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_cypher_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_cypher_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_cypher_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_cypher_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_cypher_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_cypher_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_cypher_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_cypher_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_cypher_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_cypher_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_cypher_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_cypher_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_cypher_line_8, shpbi_0, shp_0)
        label.set_xy(bull_cypher_label_1, slpbi_2, slp_2)
        label.set_xy(bull_cypher_label_2, shpbi_1, shp_1)
        label.set_xy(bull_cypher_label_3, slpbi_1, slp_1)
        label.set_xy(bull_cypher_label_4, shpbi_0, shp_0)
        label.set_xy(bull_cypher_label_5, slpbi_0, slp_0)
        label.set_text(bull_cypher_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_cypher_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_cypher_label_5, 'BULL CYPHER\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(XC: ' + str.tostring(math.round(xcrr, 2)) + ')')
    if bull_cypher_alert
        alert('Bullish Cypher')

/////////////
// GARTLEY //
/////////////

var bear_gartley_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_gartley_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_gartley_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_gartley_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_gartley_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_gartley_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_gartley_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_gartley_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_gartley_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bear_gartley_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bear_gartley_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_gartley_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_gartley_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_gartley and barstate.isconfirmed
    if show_bear_gartley
        adrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_gartley_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_gartley_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_gartley_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_gartley_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_gartley_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_gartley_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_gartley_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_gartley_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_gartley_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_gartley_line_5, shpbi_1, shp_1)
        line.set_xy1(bear_gartley_line_6, shpbi_2, shp_2)
        line.set_xy2(bear_gartley_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_gartley_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_gartley_line_7, shpbi_0, shp_0)
        line.set_xy1(bear_gartley_line_8, slpbi_1, slp_1)
        line.set_xy2(bear_gartley_line_8, slpbi_0, slp_0)
        label.set_xy(bear_gartley_label_1, shpbi_2, shp_2)
        label.set_xy(bear_gartley_label_2, slpbi_1, slp_1)
        label.set_xy(bear_gartley_label_3, shpbi_1, shp_1)
        label.set_xy(bear_gartley_label_4, slpbi_0, slp_0)
        label.set_xy(bear_gartley_label_5, shpbi_0, shp_0)
        label.set_text(bear_gartley_label_3, 'B (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_gartley_label_4, 'C (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_gartley_label_5, 'BEAR GARTLEY\nD (' + str.tostring(math.round(shrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bear_gartley_alert
        alert('Bearish Gartley')

var bull_gartley_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_gartley_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_gartley_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_gartley_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_gartley_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_gartley_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_gartley_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_gartley_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_gartley_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bull_gartley_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bull_gartley_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_gartley_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_gartley_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_gartley and barstate.isconfirmed
    if show_bull_gartley
        adrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_gartley_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_gartley_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_gartley_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_gartley_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_gartley_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_gartley_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_gartley_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_gartley_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_gartley_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_gartley_line_5, slpbi_1, slp_1)
        line.set_xy1(bull_gartley_line_6, slpbi_2, slp_2)
        line.set_xy2(bull_gartley_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_gartley_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_gartley_line_7, slpbi_0, slp_0)
        line.set_xy1(bull_gartley_line_8, shpbi_1, shp_1)
        line.set_xy2(bull_gartley_line_8, shpbi_0, shp_0)
        label.set_xy(bull_gartley_label_1, slpbi_2, slp_2)
        label.set_xy(bull_gartley_label_2, shpbi_1, shp_1)
        label.set_xy(bull_gartley_label_3, slpbi_1, slp_1)
        label.set_xy(bull_gartley_label_4, shpbi_0, shp_0)
        label.set_xy(bull_gartley_label_5, slpbi_0, slp_0)
        label.set_text(bull_gartley_label_3, 'B (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_gartley_label_4, 'C (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_gartley_label_5, 'BULL GARTLEY\nD (' + str.tostring(math.round(slrr_0, 2)) + ')\n(AD: ' + str.tostring(math.round(adrr, 2)) + ')')
    if bull_gartley_alert
        alert('Bullish Gartley')

///////////
// SHARK //
///////////

var bear_shark_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_shark_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_shark_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_shark_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_shark_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_shark_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_shark_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_shark_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'O', textcolor = label_colour)
var bear_shark_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bear_shark_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'A', textcolor = label_colour)
var bear_shark_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_shark_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_shark and barstate.isconfirmed
    if show_bear_shark
        xcrr = (shp_0 - slp_1) / (shp_2 - slp_1) * 100
        line.set_xy1(bear_shark_line_1, shpbi_2, shp_2)
        line.set_xy2(bear_shark_line_1, slpbi_1, slp_1)
        line.set_xy1(bear_shark_line_2, slpbi_1, slp_1)
        line.set_xy2(bear_shark_line_2, shpbi_1, shp_1)
        line.set_xy1(bear_shark_line_3, shpbi_1, shp_1)
        line.set_xy2(bear_shark_line_3, slpbi_0, slp_0)
        line.set_xy1(bear_shark_line_4, slpbi_0, slp_0)
        line.set_xy2(bear_shark_line_4, shpbi_0, shp_0)
        line.set_xy1(bear_shark_line_5, shpbi_2, shp_2)
        line.set_xy2(bear_shark_line_5, shpbi_0, shp_0)
        line.set_xy1(bear_shark_line_6, shpbi_1, shp_1)
        line.set_xy2(bear_shark_line_6, shpbi_0, shp_0)
        line.set_xy1(bear_shark_line_7, shpbi_1, shp_1)
        line.set_xy2(bear_shark_line_7, slpbi_0, slp_0)
        label.set_xy(bear_shark_label_1, shpbi_2, shp_2)
        label.set_xy(bear_shark_label_2, slpbi_1, slp_1)
        label.set_xy(bear_shark_label_3, shpbi_1, shp_1)
        label.set_xy(bear_shark_label_4, slpbi_0, slp_0)
        label.set_xy(bear_shark_label_5, shpbi_0, shp_0)
        label.set_text(bear_shark_label_4, 'B (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_shark_label_5, 'BEAR SHARK\nC (' + str.tostring(math.round(shrr_0, 2)) + ')\n(XC: ' + str.tostring(math.round(xcrr, 2)) + ')')
    if bear_shark_alert
        alert('Bearish Shark')

var bull_shark_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_shark_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_shark_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_shark_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_shark_line_5 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_shark_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_shark_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_shark_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'O', textcolor = label_colour)
var bull_shark_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bull_shark_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'A', textcolor = label_colour)
var bull_shark_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_shark_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_shark and barstate.isconfirmed
    if show_bull_shark
        xcrr = (shp_1 - slp_0) / (shp_1 - slp_2) * 100
        line.set_xy1(bull_shark_line_1, slpbi_2, slp_2)
        line.set_xy2(bull_shark_line_1, shpbi_1, shp_1)
        line.set_xy1(bull_shark_line_2, shpbi_1, shp_1)
        line.set_xy2(bull_shark_line_2, slpbi_1, slp_1)
        line.set_xy1(bull_shark_line_3, slpbi_1, slp_1)
        line.set_xy2(bull_shark_line_3, shpbi_0, shp_0)
        line.set_xy1(bull_shark_line_4, shpbi_0, shp_0)
        line.set_xy2(bull_shark_line_4, slpbi_0, slp_0)
        line.set_xy1(bull_shark_line_5, slpbi_2, slp_2)
        line.set_xy2(bull_shark_line_5, slpbi_0, slp_0)
        line.set_xy1(bull_shark_line_6, slpbi_1, slp_1)
        line.set_xy2(bull_shark_line_6, slpbi_0, slp_0)
        line.set_xy1(bull_shark_line_7, slpbi_1, slp_1)
        line.set_xy2(bull_shark_line_7, shpbi_0, shp_0)
        label.set_xy(bull_shark_label_1, slpbi_2, slp_2)
        label.set_xy(bull_shark_label_2, shpbi_1, shp_1)
        label.set_xy(bull_shark_label_3, slpbi_1, slp_1)
        label.set_xy(bull_shark_label_4, shpbi_0, shp_0)
        label.set_xy(bull_shark_label_5, slpbi_0, slp_0)
        label.set_text(bull_shark_label_4, 'B (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_shark_label_5, 'BULL SHARK\nC (' + str.tostring(math.round(slrr_0, 2)) + ')\n(XC: ' + str.tostring(math.round(xcrr, 2)) + ')')
    if bull_shark_alert
        alert('Bullish Shark')

/////////////////
// THREE-DRIVE //
/////////////////

var bear_three_drive_line_1 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_three_drive_line_2 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_three_drive_line_3 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_three_drive_line_4 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_three_drive_line_5 = line.new(na, na, na, na, color = bear_pattern_colour, width = 2)
var bear_three_drive_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_three_drive_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_three_drive_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_three_drive_line_9 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bear_three_drive_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = 'X', textcolor = label_colour)
var bear_three_drive_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_three_drive_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_three_drive_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bear_three_drive_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bear_three_drive_label_6 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)

if sh and bear_three_drive and barstate.isconfirmed
    if show_bear_three_drive
        line.set_xy1(bear_three_drive_line_1, slpbi_2, slp_2)
        line.set_xy2(bear_three_drive_line_1, shpbi_2, shp_2)
        line.set_xy1(bear_three_drive_line_2, shpbi_2, shp_2)
        line.set_xy2(bear_three_drive_line_2, slpbi_1, slp_1)
        line.set_xy1(bear_three_drive_line_3, slpbi_1, slp_1)
        line.set_xy2(bear_three_drive_line_3, shpbi_1, shp_1)
        line.set_xy1(bear_three_drive_line_4, shpbi_1, shp_1)
        line.set_xy2(bear_three_drive_line_4, slpbi_0, slp_0)
        line.set_xy1(bear_three_drive_line_5, slpbi_0, slp_0)
        line.set_xy2(bear_three_drive_line_5, shpbi_0, shp_0)
        line.set_xy1(bear_three_drive_line_6, slpbi_2, slp_2)
        line.set_xy2(bear_three_drive_line_6, slpbi_1, slp_1)
        line.set_xy1(bear_three_drive_line_7, shpbi_2, shp_2)
        line.set_xy2(bear_three_drive_line_7, shpbi_1, shp_1)
        line.set_xy1(bear_three_drive_line_8, shpbi_1, shp_1)
        line.set_xy2(bear_three_drive_line_8, shpbi_0, shp_0)
        line.set_xy1(bear_three_drive_line_9, slpbi_1, slp_1)
        line.set_xy2(bear_three_drive_line_9, slpbi_0, slp_0)
        label.set_xy(bear_three_drive_label_1, slpbi_2, slp_2)
        label.set_xy(bear_three_drive_label_2, shpbi_2, shp_2)
        label.set_xy(bear_three_drive_label_3, slpbi_1, slp_1)
        label.set_xy(bear_three_drive_label_4, shpbi_1, shp_1)
        label.set_xy(bear_three_drive_label_5, slpbi_0, slp_0)
        label.set_xy(bear_three_drive_label_6, shpbi_0, shp_0)
        label.set_text(bear_three_drive_label_2, '1 (' + str.tostring(math.round(shrr_2, 2)) + ')')
        label.set_text(bear_three_drive_label_3, 'A (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bear_three_drive_label_4, '2 (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bear_three_drive_label_5, 'B (' + str.tostring(math.round(slrr_0, 2)) + ')')
        label.set_text(bear_three_drive_label_6, 'BEAR THREE-DRIVE\n3 (' + str.tostring(math.round(shrr_0, 2)) + ')')
    if bear_three_drive_alert
        alert('Bearish Three-Drive')

var bull_three_drive_line_1 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_three_drive_line_2 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_three_drive_line_3 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_three_drive_line_4 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_three_drive_line_5 = line.new(na, na, na, na, color = bull_pattern_colour, width = 2)
var bull_three_drive_line_6 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_three_drive_line_7 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_three_drive_line_8 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_three_drive_line_9 = line.new(na, na, na, na, color = dot_colour, style = line.style_dashed)
var bull_three_drive_label_1 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = 'X', textcolor = label_colour)
var bull_three_drive_label_2 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_three_drive_label_3 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_three_drive_label_4 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)
var bull_three_drive_label_5 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_down, text = na, textcolor = label_colour)
var bull_three_drive_label_6 = label.new(na, na, color = color.rgb(54, 58, 69, 100), style = label.style_label_up, text = na, textcolor = label_colour)

if sl and bull_three_drive and barstate.isconfirmed
    if show_bull_three_drive
        line.set_xy1(bull_three_drive_line_1, shpbi_2, shp_2)
        line.set_xy2(bull_three_drive_line_1, slpbi_2, slp_2)
        line.set_xy1(bull_three_drive_line_2, slpbi_2, slp_2)
        line.set_xy2(bull_three_drive_line_2, shpbi_1, shp_1)
        line.set_xy1(bull_three_drive_line_3, shpbi_1, shp_1)
        line.set_xy2(bull_three_drive_line_3, slpbi_1, slp_1)
        line.set_xy1(bull_three_drive_line_4, slpbi_1, slp_1)
        line.set_xy2(bull_three_drive_line_4, shpbi_0, shp_0)
        line.set_xy1(bull_three_drive_line_5, shpbi_0, shp_0)
        line.set_xy2(bull_three_drive_line_5, slpbi_0, slp_0)
        line.set_xy1(bull_three_drive_line_6, shpbi_2, shp_2)
        line.set_xy2(bull_three_drive_line_6, shpbi_1, shp_1)
        line.set_xy1(bull_three_drive_line_7, slpbi_2, slp_2)
        line.set_xy2(bull_three_drive_line_7, slpbi_1, slp_1)
        line.set_xy1(bull_three_drive_line_8, slpbi_1, slp_1)
        line.set_xy2(bull_three_drive_line_8, slpbi_0, slp_0)
        line.set_xy1(bull_three_drive_line_9, shpbi_1, shp_1)
        line.set_xy2(bull_three_drive_line_9, shpbi_0, shp_0)
        label.set_xy(bull_three_drive_label_1, shpbi_2, shp_2)
        label.set_xy(bull_three_drive_label_2, slpbi_2, slp_2)
        label.set_xy(bull_three_drive_label_3, shpbi_1, shp_1)
        label.set_xy(bull_three_drive_label_4, slpbi_1, slp_1)
        label.set_xy(bull_three_drive_label_5, shpbi_0, shp_0)
        label.set_xy(bull_three_drive_label_6, slpbi_0, slp_0)
        label.set_text(bull_three_drive_label_2, '1 (' + str.tostring(math.round(slrr_2, 2)) + ')')
        label.set_text(bull_three_drive_label_3, 'A (' + str.tostring(math.round(shrr_1, 2)) + ')')
        label.set_text(bull_three_drive_label_4, '2 (' + str.tostring(math.round(slrr_1, 2)) + ')')
        label.set_text(bull_three_drive_label_5, 'B (' + str.tostring(math.round(shrr_0, 2)) + ')')
        label.set_text(bull_three_drive_label_6, 'BULL THREE-DRIVE\n3 (' + str.tostring(math.round(slrr_0, 2)) + ')')
    if bull_three_drive_alert
        alert('Bullish Three-Drive')
